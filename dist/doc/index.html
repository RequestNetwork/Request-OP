
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="images/favicon.png" type="image/x-icon">

    <title>Request Network for developers</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
      <img src="images/name.png" class="name" alt="Name" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="introduction">Introduction</a>
          </li>
          <li>
            <a href="#preconfiguration" class="toc-h1 toc-link" data-title="preconfiguration">Preconfiguration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#create-a-wallet-to-store-your-currencies" class="toc-h2 toc-link" data-title="create-a-wallet-to-store-your-currencies">Create a wallet to store your currencies</a>
                  </li>
                  <li>
                    <a href="#create-an-account-to-store-your-identity" class="toc-h2 toc-link" data-title="create-an-account-to-store-your-identity">Create an account to store your identity.</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#integrating-request-network" class="toc-h1 toc-link" data-title="integrating-request-network">Integrating Request Network</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#1-create-a-request-for-payment-on-your-back-end" class="toc-h2 toc-link" data-title="1-create-a-request-for-payment-on-your-back-end">1. Create a request for payment on your back-end</a>
                  </li>
                  <li>
                    <a href="#2-add-a-payment-button-on-your-front-end-and-redirect-the-user-to-the-gateway" class="toc-h2 toc-link" data-title="2-add-a-payment-button-on-your-front-end-and-redirect-the-user-to-the-gateway">2. Add a payment button on your front-end and redirect the user to the gateway</a>
                  </li>
                  <li>
                    <a href="#paying-on-the-gateway" class="toc-h2 toc-link" data-title="paying-on-the-gateway">Paying on the gateway</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#additional-info" class="toc-h1 toc-link" data-title="additional-info">Additional info</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#verify-your-orders-and-or-reconcile" class="toc-h2 toc-link" data-title="verify-your-orders-and-or-reconcile">Verify your orders and/or Reconcile</a>
                  </li>
                  <li>
                    <a href="#reconcile-the-payment-with-your-own-system" class="toc-h2 toc-link" data-title="reconcile-the-payment-with-your-own-system">Reconcile the payment with your own system</a>
                  </li>
                  <li>
                    <a href="#extras" class="toc-h2 toc-link" data-title="extras">Extras</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://request.network'>Visit request.network website</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p><a href="https://request.network">Request Network</a> is a decentralized way to accept cryptocurrencies, in the future the Request Network Foundation will also develop an even more straight forward way to start accepting them, feel free to <a href="https://network.us12.list-manage.com/subscribe/post?u=e17500a255904b2fa3482005c&amp;id=62ea53d6f0">subscribe to the newsletter</a> to get alerted.</p>

<p><em>Disclaimer: Note that the Request Network is still in beta and the library is subject to evolve in the coming months. The Request Network is a protocol which is not owned or controlled by a company. This website won’t hold your cryptocurrencies. You are in charge of setting up a wallet on your own.</em></p>

<p><strong>Features:</strong></p>

<p>During the first beta phase, the Request Network will only allow ether payments. During the second beta phase, the Request Network will allow ERC20 payments. Support for Bitcoin and other cryptocurrencies will follow closely.</p>

<p><strong>Plugins:</strong></p>

<ul>
<li>Shopify: No plugin available yet</li>
<li>WooCommerce: Plugin currently being developed (<a href="https://wooreq.com/">https://wooreq.com/</a>)</li>
</ul>

<p><strong>Steps to integrate Request Network:</strong></p>

<p>If you already have a cryptocurrency account, there are only 2 steps:</p>

<ol>
<li>Create a request for payment on your back-end</li>
<li>Add a payment button on your front-end and redirect the user to the gateway</li>
</ol>

<p>It can be done in under 30 lines of code for a quick integration and can also be customized more if you wish to synchronize the orders with your own system.</p>

<p>A full example of calling Request is available on <a href="https://github.com/RequestNetwork/Request-OP">this Github</a>.</p>
<h1 id='preconfiguration'>Preconfiguration</h1><h2 id='create-a-wallet-to-store-your-currencies'>Create a wallet to store your currencies</h2>
<p><em>If you already have your wallets set up, you can skip this part and go <a href="#create-an-account-to-store-your-identity">here</a>.</em></p>
<h3 id='ether-eth'>Ether (ETH)</h3>
<p>You need to prepare a wallet to receive the ethers.</p>

<p>An ether address looks like this: 0xdD76B55ee6dAfe0c7c978bff69206d476a5b9Ce7 </p>

<p>You can create your own address on different websites including:</p>

<ul>
<li><a href="https://www.coinbase.com">Coinbase</a> (easy set up, can be on mobile)</li>
<li><a href="https://mycrypto.com/">MyCrypto</a> (advanced setup)</li>
<li><a href="https://metamask.io/">Metamask</a> (in browser setup)</li>
<li>Hardware wallet like <a href="https://www.ledgerwallet.com/">Ledger</a> or <a href="https://trezor.io/">Trezor</a> (Hardware setup)</li>
</ul>
<h2 id='create-an-account-to-store-your-identity'>Create an account to store your identity.</h2>
<p>This account is a key that does not hold your money, the purpose is to be the  proof that you are the one asking for a payment. </p>

<p>You need to generate a 12 words mnemonic seed, then store it somewhere safe. We recommend:</p>

<ul>
<li><a href="https://iancoleman.io/bip39/">https://iancoleman.io/bip39/</a></li>
<li><a href="https://metamask.io/">Metamask</a></li>
<li><a href="https://www.ledgerwallet.com/">Ledger</a> Wallet (using a 12 words seed)</li>
</ul>

<p>If someone accesses your mnemonic seed, he won’t be able to access the money you received on the other account. However he will be able to generate Requests in your name. Consider these words as a very important password.</p>
<h1 id='integrating-request-network'>Integrating Request Network</h1>
<p>The developer view of the flow can be seen in the picture below:</p>

<p><img src="images/flow-diagram.png" alt="Developer view of the flow" /></p>
<h2 id='1-create-a-request-for-payment-on-your-back-end'>1. Create a request for payment on your back-end</h2><h3 id='a-add-dependencies-and-instantiate-request-network'>a. Add dependencies and instantiate Request Network</h3>
<blockquote>
<p>On your backend, import the libraries:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">import</span> <span class="nx">RequestNetwork</span> <span class="nx">from</span> <span class="s1">'@requestnetwork/request-network.js'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">HDWalletProvider</span> <span class="o">=</span> <span class="nx">require</span> <span class="p">(</span><span class="s1">'truffle-hdwallet-provider'</span><span class="p">);</span>
</code></pre>
<ul>
<li>Install these two dependencies:</li>
</ul>

<p><strong>request-network.js</strong> <code>npm install @requestnetwork/request-network.js --save</code></p>

<p><strong>truffle-hdwallet-provider</strong>
<code>npm install truffle-hdwallet-provider</code></p>

<ul>
<li>Instantiate Request Network:</li>
</ul>

<blockquote>
<p>Instantiating requestnetwork with HDWalletProvider on <strong>Mainnet</strong>:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kd">var</span> <span class="nx">mnemonic</span> <span class="o">=</span> <span class="s1">'twelve word mnemonic phrase of the wallet used for signing the requests'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HDWalletProvider</span><span class="p">(</span><span class="nx">mnemonic</span><span class="p">,</span> <span class="s1">'https://mainnet.infura.io/'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">networkId</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 1 is for Mainnet (4 for Rinkeby testnet, 99 for local rpc)</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">requestnetwork</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestNetwork</span><span class="p">(</span><span class="nx">provider</span><span class="p">,</span> <span class="nx">networkId</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<p>request-network.js needs a Web3 provider to sign requests.
Web3 library is a collection of modules which contain specific functionality for the ethereum ecosystem.</p>

<p>In this guide we use <strong>truffle-hdwallet-provider</strong> which instantiates a Web3 provider to sign transactions for addresses derived from a 12-word mnemonic phrase.</p>

<p><strong><code>new HDWalletProvider(mnemonic, provider_uri, index)</code></strong> (see example)</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>mnemonic</td>
<td>string</td>
<td>12 word mnemonic which addresses are created from.</td>
</tr>
<tr>
<td>provider_uri</td>
<td>number</td>
<td>URI of Ethereum client to send all Web3 requests.</td>
</tr>
<tr>
<td>index</td>
<td>number (optional)</td>
<td>If specified, will tell the provider to manage the address at the index specified. Defaults to the first address (index 0).</td>
</tr>
</tbody></table>

<p>By default, the HDWalletProvider will use the address of the first address that&#39;s generated from the mnemonic. If you pass in a specific index, it will use that address instead. Currently, the HDWalletProvider manages only one address at a time.</p>

<p><strong><code>new RequestNetwork(provider, network_id)</code></strong> (see example)</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>provider</td>
<td>object</td>
<td>Web3 Provider for the library to use.</td>
</tr>
<tr>
<td>networkId</td>
<td>number</td>
<td>network id you&#39;re using, <strong>must match the network of the provider&#39;s Ethereum client</strong>.</td>
</tr>
</tbody></table>
<h3 id='b-signing-a-request'>b. Signing a request</h3>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kd">var</span> <span class="nx">requestData</span> <span class="o">=</span> <span class="p">{</span> <span class="na">reason</span><span class="p">:</span> <span class="s1">'Order #030890 from Just Another Shop'</span><span class="p">,</span>
                    <span class="na">orderId</span><span class="p">:</span> <span class="s1">'030890'</span> <span class="p">}</span>

<span class="kd">var</span> <span class="nx">signedRequest</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">requestnetwork</span><span class="p">.</span><span class="nx">requestEthereumService</span><span class="p">.</span><span class="nx">signRequestAsPayee</span><span class="p">(</span>
          <span class="p">[</span><span class="s1">'0x8F0255e24B99825e9AD4bb7506678F18C630453F'</span><span class="p">],</span>
          <span class="p">[</span><span class="s1">'175000000000000000'</span><span class="p">],</span>
          <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3600</span><span class="p">,</span> <span class="c1">// we put expiration after 1 hour here</span>
          <span class="p">[</span><span class="s1">'0xf9DF490146b29418a59F43dDb4Afc57Cd3fEf856'</span><span class="p">],</span>
          <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">requestData</span><span class="p">),</span>
        <span class="p">);</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"currencyContract"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0xafa312973909c3a541665e11c883a24a8eb10b2c"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"QmSsrdAPhD5UkRVDKVpCwf63nrUxBaNbYmpZ2njbku9Mi5"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"expectedAmounts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"175000000000000000"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"expirationDate"</span><span class="p">:</span><span class="w"> </span><span class="mi">1522207081496</span><span class="p">,</span><span class="w">
  </span><span class="s2">"hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x0071762fae039b38da6c0685172c2de8df98eed1cbfc7b709bbe23df51c16fb3"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"payeesIdAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"0x8F0255e24B99825e9AD4bb7506678F18C630453F"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"payeesPaymentAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"0xf9DF490146b29418a59F43dDb4Afc57Cd3fEf856"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"signature"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x4708d801416d8ee4604af4bf8b3a2328592ab450d6a48c0d66446e26b51066cb2d2c568d37c38ae1bc3b48f1582e24b9c8b63bac9c548d8754f5d50b33e5fb491c"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>Now we need to ask the library to create a request for payment. </p>

<p><strong><code>async requestnetwork.requestEthereumService.signRequestAsPayee(payeesIdAddress, expectedAmounts, expirationDate, payeesPaymentAddress, metadata)</code></strong> (see example)</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>payeesIdAddress</td>
<td>string[]</td>
<td>ID address of the payee (<a href="#create-an-account-to-store-your-identity">see step in Preconfiguration</a>). Additional payees can be added in the array. Position 0 is the main payee (the one who sign the request).</td>
</tr>
<tr>
<td>expectedAmounts</td>
<td>number[]</td>
<td>Amount in Wei of the payment Request for each payee. (1Eth = 1000000000000000000 Wei)</td>
</tr>
<tr>
<td>expirationDate</td>
<td>number</td>
<td>Timestamp in seconds of the date after which the signed request can not be paid anymore. We recommend to set:  <code>new Date().getTime() + 3600</code></td>
</tr>
<tr>
<td>payeesPaymentAddress</td>
<td>string<a href="optional"></a></td>
<td>Address on which to receive the payment (<a href="#create-a-wallet-to-store-your-currencies">see step in Preconfiguration</a>) for each payee</td>
</tr>
<tr>
<td>metadata</td>
<td>String (optional)</td>
<td>Json string of the request&#39;s details (data will be hosted on ipfs). See below for more information</td>
</tr>
</tbody></table>
<h3 id='c-other-currencies-available-soon'>c. Other currencies (available soon)</h3><h3 id='d-store-metadata'>d. Store metadata</h3>
<p>Request Network supports adding metadata to every request. </p>

<p>Privacy: The metadata are public as of today. You will be able to select the privacy during the second part of the beta phase.</p>

<p>Accounting: Accounting standardized data will be specified during the first beta phase.</p>

<p>We use the following format <code>metadata = { reason: String, orderId: String }</code></p>
<h2 id='2-add-a-payment-button-on-your-front-end-and-redirect-the-user-to-the-gateway'>2. Add a payment button on your front-end and redirect the user to the gateway</h2>
<blockquote>
<p>Example of Html and css code for styling a “pay with ETH” button:</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"pay-with-button"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://payments.request.network/assets/request-logo.png"</span> <span class="na">style=</span><span class="s">"height: 30px;"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;span&gt;</span>Pay with<span class="ni">&amp;nbsp;</span><span class="nt">&lt;/span&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"https://payments.request.network/assets/eth-logo-white.png"</span> <span class="na">style=</span><span class="s">"height: 20px;"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">_ngcontent-c1=</span><span class="s">""</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span>ETH<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/button&gt;</span>

</code></pre><pre class="highlight css tab-css"><code><span class="nt">pay-with-button</span> <span class="p">{</span> 
  <span class="nl">height</span><span class="p">:</span> <span class="m">60px</span><span class="p">;</span>
  <span class="nl">min-width</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
  <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
  <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="m">#103b56</span><span class="p">;</span>
  <span class="nl">font-size</span><span class="p">:</span> <span class="m">16px</span><span class="p">;</span>
  <span class="nl">font-weight</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">white</span><span class="p">;</span>
  <span class="nl">border</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="nl">border-radius</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
  <span class="nl">border-bottom</span><span class="p">:</span> <span class="m">3px</span> <span class="nb">solid</span> <span class="m">#6CFDCC</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span> <span class="m">16px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre><h3 id='a-adding-the-button-to-your-website'>a. Adding the button to your website</h3>
<p><img src="images/button.png" alt="pay-with button" /></p>

<p>See example code for styling a &quot;paywith ETH&quot; button.</p>
<h3 id='b-redirect-to-the-gateway'>b.  Redirect to the gateway</h3>
<p>In order to ease the process for integrating a pay-with-request button on your website, the request app provides a gateway for displaying the info of a signed request and allowing someone to pay it.</p>

<blockquote>
<p>Example for redirectiong to the gateway with right parameters:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kd">var</span> <span class="nx">qs</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">signedRequest</span><span class="p">:</span> <span class="nx">signedRequest</span><span class="p">,</span> <span class="na">callbackUrl</span><span class="p">:</span> <span class="nx">myCallbackUrl</span><span class="p">,</span> <span class="na">networkId</span><span class="p">:</span> <span class="mi">1</span><span class="p">}));</span>
<span class="kd">var</span> <span class="nx">qsBase64</span> <span class="o">=</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">qs</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s1">'https://app.request.network/#/pay-with-request/'</span> <span class="o">+</span> <span class="nx">qsBase64</span><span class="p">;</span>
</code></pre>
<p>The gateway url is <code>https://app.request.network/#/pay-with-request/&lt;qsBase64&gt;</code></p>

<p>where <code>qsBase64</code> is a base 64 encoded string of a JSON object containing the following <strong>mandatory</strong> parameters</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>signedRequest</td>
<td>object</td>
<td>signed request object (see paragraph above for format)</td>
</tr>
<tr>
<td>callbackUrl</td>
<td>string</td>
<td>url for the gateway to redirect after request has been paid</td>
</tr>
<tr>
<td>networkId</td>
<td>string</td>
<td>id of the network on which you signed the request (<a href="#1-create-a-request-for-payment-on-your-back-end">see step 1.</a>)</td>
</tr>
</tbody></table>
<h2 id='paying-on-the-gateway'>Paying on the gateway</h2>
<p>You can find an example of how a signed request looks like on the gateway on this <a href="https://app.request.network/#/pay-with-request/eyJzaWduZWRSZXF1ZXN0Ijp7ImN1cnJlbmN5Q29udHJhY3QiOiIweGQ4OGFiOWIxNjkxMzQwZTA0YTViYmY3ODUyOWMxMWQ1OTJkMzVmNTciLCJkYXRhIjoiUW1Tc3JkQVBoRDVVa1JWREtWcEN3ZjYzbnJVeEJhTmJZbXBaMm5qYmt1OU1pNSIsImV4cGVjdGVkQW1vdW50cyI6WyIxNzUwMDAwMDAwMDAwMDAwMDAiXSwiZXhwaXJhdGlvbkRhdGUiOjE1MjQ3MTgxMzEzNjYsImhhc2giOiIweDQ1MmRlMGE2OWI3ZDBmM2I5N2ZlOTY5Mjg0NmZmOGM2NzkyODZhZDRmZGY0NGFkNjI3YWNkNWJmNzlmM2RjYTciLCJwYXllZXNJZEFkZHJlc3MiOlsiMHg4RjAyNTVlMjRCOTk4MjVlOUFENGJiNzUwNjY3OEYxOEM2MzA0NTNGIl0sInBheWVlc1BheW1lbnRBZGRyZXNzIjpbIjB4ZjlERjQ5MDE0NmIyOTQxOGE1OUY0M2REYjRBZmM1N0NkM2ZFZjg1NiJdLCJzaWduYXR1cmUiOiIweDE1ZWMwZjRlZjE3N2U1ZTk5YjRjYmUyOTI4NzY1MTY5ZDEwNzYxYzNlNzVjNzU0OTI3ODE3MDVhZTQ4MzlmZTg0NmVkYzAyMmExNjI1MzViOWQ1MDg4MmI2NTFmZGMyYTc1MTg3MzY0MWY2ZjA0NjQ5YjBjNGU4ODUzN2MwNjg1MWMifSwiY2FsbGJhY2tVcmwiOiJodHRwczovL3BheW1lbnRzLnJlcXVlc3QubmV0d29yay8jL2NvbmZpcm0vIiwibmV0d29ya0lkIjo0fQ">link</a></p>

<p>On the gateway, the payer connects to his ether wallet and pays the request.</p>

<p>Once the payment transaction is broadcasted, the gateway redirect to the <strong>callbackUrl</strong> concatenated with the string of the transaction hash.</p>

<p>Example:</p>

<p><code>myCallbackUrl/0xb8e90ba15bb09d1b5baba628fcc01d0302d8d47dc854e85e6deeb5c60f6d3f2b</code></p>

<p>Otherwise, if the payer click on &#39;cancel &amp; go back to merchant&#39;, the gateway will redirect to the <strong>callbackUrl</strong> concatenated with the signed request json object stringified.</p>

<aside class="success">
Your signature ensure that only the information you signed can be broadcasted on ethereum's blockchain
</aside>
<h1 id='additional-info'>Additional info</h1><h2 id='verify-your-orders-and-or-reconcile'>Verify your orders and/or Reconcile</h2>
<p>After paying on the gateway the user is now redirected to your callback URL and you can display a custom message to confirm the success of the operation.</p>

<p>Note that as a blockchain payment is only confirmed after a certain time, you can’t be sure that the payment has been done at this moment.</p>

<p>You can view your payments at this URL, replacing the address with your own ID address (created in paragraph <a href="#preconfiguration">Preconfiguration</a>)
https://app.request.network/#/search/0x54B4B2d8E2ECcC99385B01bE13DFB473c7885286</p>
<h2 id='reconcile-the-payment-with-your-own-system'>Reconcile the payment with your own system</h2>
<blockquote>
<p>Example:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code> <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">txHash</span> <span class="o">=</span> <span class="mh">0xb8e90ba15bb09d1b5baba628fcc01d0302d8d47dc854e85e6deeb5c60f6d3f2b</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">requestnetwork</span><span class="p">.</span><span class="nx">requestCoreService</span><span class="p">.</span><span class="nx">getRequestByTransactionHash</span><span class="p">(</span><span class="nx">txHash</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"transaction"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"blockHash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x0000000000000000000000000000000000000000000000000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"blockNumber"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x1AA3fFefeaeC333f9BF76b705547D08c90cC1280"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"gas"</span><span class="p">:</span><span class="w"> </span><span class="mi">287504</span><span class="p">,</span><span class="w">
    </span><span class="s2">"gasPrice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x8083f504e6f515a5c98debcbd54fd1c98c86d9eff7098d1b701e8eacbe5856e8"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"input"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x9dbdd85c00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000001626ac2d6390000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000008c8f0255e24b99825e9ad4bb7506678f18c630453f0000000000000000000000000000000000000000018f0255e24b99825e9ad4bb7506678f18c630453f000000000000000000000000000000000000000000000000026db992a3b180002e516d537372644150684435556b5256444b567043776636336e72557842614e62596d705a326e6a626b75394d693500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f9df490146b29418a59f43ddb4afc57cd3fef8560000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000026db992a3b180000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004156d628e48ead956625124627ad2dafb4d51a9e913339038de8aeefd1b017fc921917a2c9d73e94d8836a757ac7722588063b907c14834f069627bf36a6ca0ef61b00000000000000000000000000000000000000000000000000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"nonce"</span><span class="p">:</span><span class="w"> </span><span class="mi">79</span><span class="p">,</span><span class="w">
    </span><span class="s2">"to"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0xAFA312973909C3a541665e11C883a24a8eb10b2C"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"transactionIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"175000000000000000"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"v"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x2c"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"r"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0xbaf3e6351bd41581f3557a0baef9f63eaee184327b2f698a1b7697f70f9006fe"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"s"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x664b8f600a6ce7b0806780dfcc657e84dd281d2896289eaf11da9daf303e1640"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"method"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"broadcastSignedRequestAsPayer"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"0"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x8f0255e24b99825e9ad4bb7506678f18c630453f0000000000000000000000000000000000000000018f0255e24b99825e9ad4bb7506678f18c630453f000000000000000000000000000000000000000000000000026db992a3b180002e516d537372644150684435556b5256444b567043776636336e72557842614e62596d705a326e6a626b75394d6935"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"1"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"0xf9DF490146b29418a59F43dDb4Afc57Cd3fEf856"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"2"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"175000000000000000"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"3"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="s2">"4"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1522209576505"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"5"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x56d628e48ead956625124627ad2dafb4d51a9e913339038de8aeefd1b017fc921917a2c9d73e94d8836a757ac7722588063b907c14834f069627bf36a6ca0ef61b"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"__length__"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
        </span><span class="s2">"_requestData"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x8f0255e24b99825e9ad4bb7506678f18c630453f0000000000000000000000000000000000000000018f0255e24b99825e9ad4bb7506678f18c630453f000000000000000000000000000000000000000000000000026db992a3b180002e516d537372644150684435556b5256444b567043776636336e72557842614e62596d705a326e6a626b75394d6935"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"_payeesPaymentAddress"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"0xf9DF490146b29418a59F43dDb4Afc57Cd3fEf856"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"_payeeAmounts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"175000000000000000"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="s2">"_additionals"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="s2">"_expirationDate"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1522209576505"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"_signature"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x56d628e48ead956625124627ad2dafb4d51a9e913339038de8aeefd1b017fc921917a2c9d73e94d8836a757ac7722588063b907c14834f069627bf36a6ca0ef61b"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre><h3 id='1-query-the-hash-received-during-the-callback-from-your-backend-to-know-which-order-it-is'>1. Query the hash received during the callback from your backend to know which order it is</h3>
<p>If you need to reconcile the payment with your own system, the library provides a method for getting the transaction information from a txHash:</p>

<p><strong><code>async requestnetwork.requestCoreService.getRequestByTransactionHash(txHash)</code></strong></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>txHash</td>
<td>string</td>
<td>hash of the ethereum transaction</td>
</tr>
</tbody></table>

<aside class="notice">
Transaction information may not appear instantly after user paid the request and got redirected to the callbackUrl.
Also you will have to call the method getRequestByTransactionHash until you receive a response with the transaction data.
</aside>
<h3 id='2-compare-the-signature-to-verify-the-order-is-as-expected'>2. Compare the signature to verify the order is as expected</h3>
<p>Once you receive the <strong>transaction</strong> object, you need to check some parameters to ensure it actually corresponds to the broadcast of a request payment transaction.</p>

<ul>
<li>First one is verifying the name of the method called is &quot;broadcastSignedRequestAsPayer&quot;:</li>
</ul>

<p><code>transaction.method.name == &#39;broadcastSignedRequestAsPayer&#39;</code></p>

<blockquote>
<p>Example for getting additionnal info of the transaction:</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">data</span> <span class="o">=</span> <span class="nx">requesnetwork</span><span class="p">.</span><span class="nx">requestCoreService</span><span class="p">.</span><span class="nx">parseBytesRequest</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">parameters</span><span class="p">.</span><span class="nx">_requestData</span><span class="p">);</span>
</code></pre>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"creator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x8f0255e24b99825e9ad4bb7506678f18c630453f"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"payer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x0000000000000000000000000000000000000000"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"mainPayee"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0x8f0255e24b99825e9ad4bb7506678f18c630453f"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expectedAmount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"26db992a3b18000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"subPayees"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="s2">"QmSsrdAPhD5UkRVDKVpCwf63nrUxBaNbYmpZ2njbku9Mi5"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ul>
<li>Second one is verifying that the amount paid matches the total amount of the request</li>
</ul>

<p>For that you need to call an additionnal method:</p>

<p><strong><code>requestnetwork.requestCoreService.parseBytesRequest(requestData)</code></strong></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>requestData</td>
<td>string</td>
<td>request data bytes (variable found in transaction json object above <code>transaction.method.parameters._requestData</code>)</td>
</tr>
</tbody></table>

<aside class="notice">
From that point if you stored the signed request information on a database, you just need to verify that transaction.method.parameters._signature matches a known signature
</aside>
<h3 id='3-query-the-blockchain-until-the-payment-is-complete'>3. Query the blockchain until the payment is complete</h3>
<p>You need to query getRequestByTransactionHash until you have a request object with and verify the payment is correct.</p>
<h2 id='extras'>Extras</h2><h3 id='converting-currencies'>Converting currencies</h3>
<p>A request has to be paid in the cryptocurrency it was created with for the moment. </p>

<p>In the future, the request will be able to convert the currency automatically.</p>

<p>If you would like to exchange cryptocurrency to fiat money, you will have to use one of the cryptocurrency exchange available in your country. </p>
<h3 id='disputes-amp-fraud'>Disputes &amp; Fraud</h3>
<p>There is no chargeback on the blockchain. To protect the user, automated escrow systems will be created and adding to this documentation in S2 2018.</p>
<h3 id='recurring-payments-not-available-yet'>Recurring payments (not available yet)</h3><h3 id='creating-your-own-gateway'>Creating your own gateway</h3>
<p>The Request Network Foundation is managing the app.request.network gateway. Anyone can create its own process or gateway to pay a request, by using the resources below.</p>

<p>Resources:</p>

<p>https://github.com/RequestNetwork/Request/wiki</p>

<p>https://github.com/RequestNetwork/Requestnetwork</p>
<h3 id='next-steps'>Next steps</h3>
<p>A dashboard is under development and will simplify the merchant process.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
